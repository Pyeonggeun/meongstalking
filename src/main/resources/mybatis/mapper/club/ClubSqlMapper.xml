<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.psychopath.dogstalking.club.mapper.ClubSqlMapper">

    <insert id="insertFreeBoard">
        INSERT INTO ms_club_freeboard(club_pk,user_pk,title,content)
        VALUES (#{club_pk},#{user_pk},#{title},#{content})
    </insert>


    <select id="selectFreeBoardAll" resultType="map">
        SELECT *
        FROM ms_club_freeboard
        JOIN ms_user ON ms_user.USER_PK = ms_club_freeboard.user_pk
        where ms_club_freeboard.club_pk=#{club_pk}
    </select>

    <!-- 댓글 -->

	<insert id="insertComment">
		INSERT INTO ms_club_freeboard_comment(user_pk,clubfreeboard_pk,content)
        VALUES (#{user_pk},#{clubfreeboard_pk},#{content})
        
	</insert>

    <select id="selectCommentAll" resultType="map">
    SELECT * FROM ms_club_freeboard_comment
    JOIN ms_user ON ms_user.USER_PK = ms_club_freeboard_comment.user_pk
    WHERE clubfreeboard_pk = #{clubfreeboard_pk}
    </select>

    <!-- 길드 가입 여부 -->
    <select id="applyClubUserTF" resultType="map">
    <![CDATA[
        SELECT  
        CASE WHEN COUNT(*) > 0 THEN 'T' ELSE 'F' END AS user_exists,
        ms_club_user.*,
        ms_user.*,
        ms_club.*,
        ms_club.name AS clubname,
        ms_club.content AS clubcontent 
        FROM 
            ms_club_user
            JOIN ms_user ON ms_user.user_pk = ms_club_user.user_pk
            JOIN ms_club ON ms_club.club_pk = ms_club_user.club_pk 
        WHERE 
            ms_user.user_pk = #{user_pk}
    ]]>
    </select>


    <!--길드 개설-->
    <insert id="insertClub">
		INSERT INTO ms_club(name,content)
        VALUES (#{name},#{content})
	</insert>

    <insert id="insertClubUser">
		INSERT INTO ms_club_user(user_pk,club_pk,content)
        VALUES (#{user_pk},#{club_pk},"길드 개설자")
	</insert>

    <insert id="insertClubUsers">
		INSERT INTO ms_club_user(user_pk,club_pk,content)
        VALUES (#{user_pk},#{club_pk},#{content})
	</insert>

    <select id="checka" resultType="int">
        SELECT MAX(club_user_pk) FROM ms_club_user
    </select>
    
    <select id="selectClubList" resultType="map">
        SELECT * FROM ms_club ORDER BY RAND()
    </select>
     
    <select id="showclubpk" resultType="map">
        SELECT 
            1 AS clubpk_ck,
            ms_club.*
        FROM ms_club 
        WHERE ms_club.club_pk = #{club_pk}
    </select>
    

    <!--회원 신청 상태-->
    <insert id="insertUserStatusLog">
        INSERT INTO ms_club_user_statuslog(club_user_pk,clubcategory_pk)
        VALUES (#{club_user_pk},2); 
    </insert>

    <!--개설시 리더 자동 위임-->
    <insert id="insertLeader">
        INSERT INTO ms_club_user_ranklog(club_user_pk,clubuserranklogcategory_pk)
        VALUES (#{club_user_pk},1); 
    </insert>
</mapper>