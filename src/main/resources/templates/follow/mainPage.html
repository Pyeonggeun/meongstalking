<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <script src="https://kit.fontawesome.com/fdd6196f61.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

        <style>
            /* 글꼴 */
            @font-face {
                font-family: 'omyu_pretty';
                src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_2304-01@1.0/omyu_pretty.woff2') format('woff2');
                font-weight: normal;
                font-style: normal;
            }

            body {
                font-family: 'omyu_pretty';
                min-width: 375px;
            }

        </style>

        <style>
            /* icon */
            .my_location_icon {
                font-variation-settings:
                var(--icon-fill-fill);
                position: absolute;
                color: var(--reloadPosition-icon-color);
                font-size: var(--reloadPosition-icon-size);
                top: calc(50% - var(--reloadPosition-icon-size) / 2);
                left: calc(50% - var(--reloadPosition-icon-size) / 2);
                user-select: none;
            }

            .bi-backpack2-fill {
                position: absolute;
                font-size: 1.2rem;
                top: calc(50% - 0.6rem);
                left: 10%;
                color: #6D6D6D;
            }

            .bi-gift-fill {
                position: absolute;
                font-size: 1.2rem;
                top: calc(50% - 0.6rem);
                left: calc(50% - 0.6rem);
                color: #6D6D6D;
            }

            .military_tech_icon {
                font-variation-settings:
                var(--icon-fill-fill);
                position: absolute;
                font-size: 1.5rem;
                top: calc(50% - 0.55rem);
                right: 10%;
                color: #6D6D6D;
                user-select: none;
            }

        </style>

        <style>
            /* base */
            :root {
                --icon-fill-fill: 'FILL' 1;
                --icon-fill-empty: 'FILL' 0;

                --border-circular: 50%;
                --color-white: white;
                --color-black: black;

                --myposition-firstCircle-color: rgb(0, 0, 0, 0.1);
                --myposition-secondCircle-boxshadow: 0 0 2px 2px rgb(0, 0, 0, 0.4);
                --myposition-firstCircle-opacity: 10%;
                --myPosition-firstCircle-diameter: 2rem;
                --myPosition-secondCircle-diameter: 0.9rem;
                --myPosition-thirdCircle-diameter: 0.65625rem;

                --reloadPosition-diameter: 2.5rem;
                --reloadPosition-border: 1.5px solid #E5E5E5;
                --reloadPosition-boxshadow: 0 1px 1px 0.5px rgb(0, 0, 0, 0.2);
                --reloadPosition-icon-color: #6D6D6D;
                --reloadPosition-icon-size: 1.5rem;
            }

            #map {
                width: 100vw;
                height: 100vh;
            }

        </style>

        <style>
            /* 위치 */
            .myPosition {
                position: absolute;
                z-index: 1000;
                top: calc(50% - var(--myPosition-radius));
                left: calc(50% - var(--myPosition-radius));
                border-radius: var(--border-circular);
            }

            #thirdCircle {
                width: var(--myPosition-thirdCircle-diameter);
                height: var(--myPosition-thirdCircle-diameter);
                --myPosition-radius: var(--myPosition-thirdCircle-diameter) / 2;
                background: var(--color-black);
            }

            #secondCircle {
                width: var(--myPosition-secondCircle-diameter);
                height: var(--myPosition-secondCircle-diameter);
                --myPosition-radius: var(--myPosition-secondCircle-diameter) / 2;
                background: var(--color-white);
                box-shadow: var(--myposition-secondCircle-boxshadow);
            }

           #firstCircle {
                width: var(--myPosition-firstCircle-diameter);
                height: var(--myPosition-firstCircle-diameter);
                --myPosition-radius: var(--myPosition-firstCircle-diameter) / 2;
                background: var(--myposition-firstCircle-color);
           }

        </style>

        <style>
            /* 내 위치 */
            #reloadPositionButton {
                position: absolute;
                z-index: 1000;
                width: var(--reloadPosition-diameter);
                height: var(--reloadPosition-diameter);
                top: 80%;
                right: 4%;
                border-radius: var(--border-circular);
                background: rgb(255, 255, 255, 0.8);;
                border: var(--reloadPosition-border);
                box-shadow: var(--reloadPosition-boxshadow);
            }

        </style>

        <style>
            /* 내 가방 */
            #collectionButton {
                position: absolute;
                z-index: 1000;
                width: 7rem;
                height: 2.5rem;
                top: 87%;
                right: 0%;
                border-radius: 12.5% 0% 0% 12.5% / 25% 0% 0% 25% ;
                background: rgb(255, 255, 255, 0.8);
                box-shadow: var(--reloadPosition-boxshadow);
            }
        </style>

        <script>

            let user_pk;

            let map;

            const staticLat = 37.4996259;
            const staticLng = 127.0304801;

            let currentLat;
            let currentLng;

            function reloadMyPosition() {
                getMyLocation();
            }

            window.addEventListener("DOMContentLoaded", () => {

                createMap();
                getMyLocation();
                
            });

        </script>

    </head>

    <body>

        <div class="container-fluid">
            <div class="row">
                <div class="col px-0">
                    <div id="map"></div>
                    <div onclick="reloadMyPosition()" id="reloadPositionButton">
                        <span class="material-symbols-outlined my_location_icon">
                            my_location
                        </span>
                    </div>
                    <div id="collectionButton">
                        <i class="bi bi-backpack2-fill"></i>
                        <i class="bi bi-gift-fill"></i>
                        <span class="material-symbols-outlined military_tech_icon">
                            military_tech
                        </span>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                    <div></div>
                </div>
            </div>
            <div class="row fixed-bottom">
                <div class="col bg-white" style="height: 41px;"></div>
            </div>
        </div>

        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a277eb582a644847f86de6196a42745f"></script>
        <script>

            let myMarker;

            function createMap() {
                const mapContainer = document.getElementById("map");
                mapOption = {
                    center: new kakao.maps.LatLng(staticLat, staticLng),
                    level: 1
                };

                map = new kakao.maps.Map(mapContainer, mapOption);
            }

            function getMyLocation() {
                if(navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {
                        currentLat = position.coords.latitude;
                        currentLng = position.coords.longitude;

                        let currentPosition = new kakao.maps.LatLng(currentLat, currentLng)

                        displayMarker(currentPosition);
                    });
                }else {
                    let staticPosition = new kakao.maps.LatLng(staticLat, staticLng);

                    displayMarker(staticPosition);
                }
            }

            function displayMarker(locPosition) {
                if(!myMarker) {
                    var content = '<div id="firstCircle" class="myPosition">' + 
                        '<div id="secondCircle" class="myPosition">' + 
                        '<div id="thirdCircle" class="myPosition">' + 
                        '</div></div></div>';
                    
                    myMarker = new kakao.maps.CustomOverlay({
                        position: locPosition,
                        content: content
                    });
                }else {
                    myMarker.setPosition(locPosition);
                }
                myMarker.setMap(map);
                map.setCenter(locPosition);
            }

        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    </body>
    
</html>