<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
        <script src="https://kit.fontawesome.com/fdd6196f61.js" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

        <link rel="stylesheet" th:href="@{/public/css/follow/root.css}" />
        <link rel="stylesheet" th:href="@{/public/css/follow/font.css}" />
        <link rel="stylesheet" th:href="@{/public/css/follow/clickEffect.css}" />
        <link rel="stylesheet" th:href="@{/public/css/follow/icon.css}" />
        <link rel="stylesheet" th:href="@{/public/css/follow/marker.css}" />
        <link rel="stylesheet" th:href="@{/public/css/follow/myPosition.css}" />
        <link rel="stylesheet" th:href="@{/public/css/follow/myBag.css}" />
        <link rel="stylesheet" th:href="@{/public/css/follow/action.css}" />

        <script src="/public/js/commons/lockLikeMobile.js"></script>

        <style>

            .container-fluid {
                overflow: hidden;
                width: 100vw;
                height: 100vh;
            }

            #map {
                position: relative;
                width: 100%;
                height: 100vh;
            }
            
        </style>

        <script>

            let user_pk;

            let map;

            const staticLat = 37.4996259;
            const staticLng = 127.0304801;

            let currentLat; 
            let currentLng;

            const totalMarkingCountEveryDay = 3;
            const markingRadius = 100;
            const markingDate = 7;

            let markedMineMarkers = [];
            let tracingMarkers = [];
            let tracingInfoMarkers = [];

            function clickEffect(e) {
                const d = document.createElement("div");
                d.className="clickEffect";
                d.style.top = e.clientY + "px";
                d.style.left = e.clientX + "px";
                document.body.appendChild(d);
                d.addEventListener('animationend', function() {
                    d.parentElement.removeChild(d);
                }.bind(this));
            }

            function showActionMenu() {
                document.getElementById("actionMenuButton").hidden = true;
                document.getElementById("actionCloseButton").hidden = false;

                const actionBackgroundCircle = document.getElementById("actionBackgroundCircle");
                actionBackgroundCircle.hidden = false;
                actionBackgroundCircle.style.animation = 'showBackgroundCircle 0.3s linear 1';
                
                for(e of document.getElementsByClassName("actionCircleOut")) {
                    e.hidden = false;
                    e.style.animation = e.id + 'SpreadOut 0.4s linear 1';
                    e.style.animationFillMode = 'both';
                }

                const reloadPositionButton = document.getElementById("reloadPositionButton");
                reloadPositionButton.style.animation = 'hideSomthing 0.2s linear 1';
                reloadPositionButton.style.animationFillMode = 'both';
                
                const collectionButton = document.getElementById("collectionButton");
                collectionButton.style.animation = 'hideSomthing 0.2s linear 1';
                collectionButton.style.animationFillMode = 'both';

                setTimeout(() => {
                    reloadPositionButton.hidden = true;
                    collectionButton.hidden = true;
                }, 200);

            }

            function hideActionMenu() {

                const actionCircleOut = document.getElementsByClassName("actionCircleOut");

                for(e of actionCircleOut) {
                    e.style.animation = e.id + 'SpreadIn 0.3s linear 1';
                    e.style.animationFillMode = 'both';
                }

                setTimeout(() => {
                    document.getElementById("actionCloseButton").hidden = true;

                    const actionMenuButton = document.getElementById("actionMenuButton");
                    actionMenuButton.style.animation = 'showSomthing 0.3s linear 1';
                    actionMenuButton.style.animationFillMode = 'both';
                    actionMenuButton.hidden = false;

                    const reloadPositionButton = document.getElementById("reloadPositionButton");
                    reloadPositionButton.style.animation = 'showSomthing 0.3s linear 1';
                    reloadPositionButton.style.animationFillMode = 'both';

                    const collectionButton = document.getElementById("collectionButton");
                    collectionButton.style.animation = 'showSomthing 0.3s linear 1';
                    collectionButton.style.animationFillMode = 'both';

                    reloadPositionButton.hidden = false;
                    collectionButton.hidden = false;
                }, 150);

                const actionBackgroundCircle = document.getElementById("actionBackgroundCircle");
                actionBackgroundCircle.style.animation = 'hideBackgroundCircle 0.3s linear 1';
                
                setTimeout(() => {
                    actionBackgroundCircle.hidden = true;
                    for(e of actionCircleOut) {
                        e.hidden = true;
                    }
                }, 300);
            }

            document.addEventListener('click', clickEffect);

            function getUserPk() {

                const url = "./getUserPk";

                fetch(url)
                .then(response => response.json())
                .then(response => {
                    user_pk = response.data;
                    checkWriteMarkCount();
                    getTrackingList();
                });

            }

            function marking() {

                removeMarkedMineMarkers();
                isFirstTimeMark();

            }

            function isFirstTimeMark() {

                const url = "./isFirstTimeMark?user_pk=" + user_pk;

                fetch(url)
                .then(response => response.json())
                .then(response => {
                    let isFirstTimeMark_boolean = response.data;

                    if(isFirstTimeMark_boolean) {
                        showMoreInfoAlertModal();
                    }else {
                        getMyLocation();
                        setTimeout(() => {
                            checkWriteMarkDistanceWithScan();
                        }, 500);
                    }

                }).catch((error) => {
                    alert("으아아아: " + error);
                });

            }

            function textToUpperCase(target) {

                target.value = target.value.toUpperCase();

            }

            function saveMoreInfo() {
                const height = document.getElementById("moreInfoHeight").value;
                const weight = document.getElementById("moreInfoWeight").value;
                const bloodType = document.getElementById("moreInfoBloodType").value;
                const mbtiType = document.getElementById("moreInfoMbtiType").value;
                const hobby = document.getElementById("moreInfoHobby").value;
                const drink = document.querySelector('input[name="isDrink"]:checked').value;
                const smoke = document.querySelector('input[name="isSmoke"]:checked').value;
                const preference = document.getElementById("moreInfoPreference").value;

                if(height == "" || weight == "" || bloodType == "" || mbtiType == "" ||
                    hobby == "" || drink == "" || smoke == "" || preference == "0") {
                    showFillAlertModal();
                    return;
                }

                const url = "./insertMoreInfo?user_pk="+user_pk+"&height="+height+"&weight="+weight+
                    "&blood_type="+bloodType+"&mbti_type="+mbtiType+"&hobby="+hobby+"&drinking="+drink+"&smoking="+smoke+"&preference="+preference;

                fetch(url)
                .then(response => response.json())
                .then(response => {
                    showSuccessMoreInfoAlertModal();
                });
            }

            function inputImage() {
                const input = document.getElementById("writeMarkImage");
                input.click();
            }

            function previewImage() {
                const input = document.getElementById("writeMarkImage");
                const writeMarkImageHere = document.getElementById("writeMarkImageHere");
                if([...input.files].length === 0) {
                    return;
                }

                const imageUrl = URL.createObjectURL(input.files[0]);
                document.getElementById("writeMarkNoimage").hidden = true;
                writeMarkImageHere.style.background = "url(" + imageUrl + ") no-repeat center";
                writeMarkImageHere.style.backgroundSize = "cover";
            }

            function saveWriteMarkInfo() {

                const input = document.getElementById("writeMarkImage");
                const content = document.getElementById("writeMarkContent").value;
                const formData = new FormData();
                formData.append("user_pk", user_pk);
                formData.append("content", content);
                formData.append("latitude", currentLat);
                formData.append("longitude", currentLng);
                formData.append("imageFile", input.files[0]);

                const url = "./saveWriteMarkInfo";
                const option = {
                    method: "post",
                    "Content-Type": "multipart/form-data",
                    body: formData
                };

                fetch(url, option)
                .then(response => {
                    checkWriteMarkCount();
                    hideActionMenu();
                    const modal = bootstrap.Modal.getOrCreateInstance("#writeMarkModal");
                    modal.hide();
                    showJustBeforeIMarked();
                }).catch(error => {

                    //error.message
                    //error.stack
                    //error.name
                    document.getElementById("ggg").innerText = error.message;
                    document.getElementById("hhh").innerText = error.stack;
                    document.getElementById("jjj").innerText = error.name;

                    alert("으아아22: " + error);
                });

            }

            function showJustBeforeIMarked() {

                const url = "./getJustBeforeIMarked?user_pk=" + user_pk;

                fetch(url)
                .then(response => response.json())
                .then(response => {
                    var position = new kakao.maps.LatLng(currentLat, currentLng);
                    displayMarkedMine(position, response.data);
                })

            }

            function checkWriteMarkDistanceWithScan() {

                hideActionMenu();
                markedScan();
                setTimeout(() => {
                    checkWriteMarkDistance();
                }, 3000);
                
            }

            function checkWriteMarkDistance() {
                const url = "./checkWriteMarkDistance?user_pk=" + user_pk + "&markingRadius=" + markingRadius +
                    "&markingDate=" + markingDate + "&latitude=" + currentLat + "&longitude=" + currentLng;
                
                fetch(url)
                .then(response => response.json())
                .then(response => {
                    if(response.data.length <= 0) {
                        showWriteMarkModal();
                    }else {

                        let delay = 0;
                        for(e of response.data) {

                            setTimeout(() => {
                                var position = new kakao.maps.LatLng(e.latitude, e.longitude)
                                displayMarkedMine(position, e);
                                console.log("0.5초");   
                            }, delay)
                            
                            delay += 500;

                        }

                        setTimeout(() => {
                            showAlreadyMakredAlertModal();
                        }, 500);

                    }

                });
            }

            function checkWriteMarkCount() {

                const url = "./checkWriteMarkCount?user_pk=" + user_pk;

                fetch(url)
                .then(response => response.json())
                .then(response => {
                    if(totalMarkingCountEveryDay - response.data == 0) {
                        document.getElementById("markButton").classList.add("disabled");
                        showAllUsedAlertModal();
                    }
                });

            }

            function showScanResult() {
                
                const url = "./getScanResult?user_pk=" + user_pk + "&latitude=" + currentLat + "&longitude=" + currentLng;

                fetch(url)
                .then(response => response.json())
                .then(response => {

                    if(response.data.length == 0) {
                        showNoMakredAlertModal();
                        return;
                    }
                    
                    let delay = 0;                    
                    for(let e of response.data) {

                        setTimeout(() => {
                            const position = new kakao.maps.LatLng(e.latitude, e.longitude);
                            displayMarkedMine(position, e);
                            console.log("0.5초");
                        }, delay);

                        delay += 500;

                    }
                    
                });

            }

            function collectMarkedInfo(e) {
                const url = "./insertCollectionInfo?user_pk=" + user_pk + "&log_pk=" + e.log_pk;

                fetch(url)
                .then(response => response.json())
                .then(response => {
                    document.getElementById("showMarkedImage").style.background = 
                        "url(/uploadFiles/" + e.image_link + ") no-repeat center";
                    document.getElementById("showMarkedImage").style.backgroundSize = "cover";
                    document.getElementById("showMarkedContent").innerText = e.content;
                    document.getElementById("collectButton").hidden = true;
                    document.getElementById("showMarkedHideContent").hidden = true;
                    document.getElementById("showMarkedHideImage").hidden = true;

                    removeMarkedMineMarkers();
                    
                });
            }

            function reloadCollectionPersonList() {

                const url = "./getCollectionPersonList?user_pk=" + user_pk;

                fetch(url)
                .then(response => response.json())
                .then(response => {
                    
                    if(response.data.length == 0) {
                        
                        return;
                    }

                    const collectionPersonBox = document.getElementById("collectionPersonBox");

                    for(e of response.data) {

                        const collectionPersonWrapper = document.querySelector("#templete .collectionPersonWrapper").cloneNode(true);

                        collectionPersonWrapper.querySelector(".collectionPersonRateCircle");
                        const collectionPersonImage = collectionPersonWrapper.querySelector(".collectionPersonImage");

                        if(e.open_rating >= 9) {
                            collectionPersonImage.innerText = "";
                            collectionPersonImage.style.background = "url(/uploadFiles/" + e.profile_photo + ") no-repeat center";
                            collectionPersonImage.style.backgroundSize = "cover";
                        }

                        const likeHeart = collectionPersonWrapper.querySelector(".likeHeart");
                        likeHeart.setAttribute("id", e.user_pk);

                        if(e.is_like == 'Y') {
                            likeHeart.classList.remove("bi-heart");
				            likeHeart.classList.add("bi-heart-fill");
                        }else {
                            likeHeart.classList.remove("bi-heart-fill");
				            likeHeart.classList.add("bi-heart");
                        }
                        
                        const collectionPersonRateContent = collectionPersonWrapper.querySelector(".collectionPersonRateContent");
                        let cnt = 0;

                        if(e.star_rating == 'oneStar') {
                            cnt = 1;
                        }else if(e.star_rating == 'twoStar') {
                            cnt = 2;
                        }else if(e.star_rating == 'threeStar') {
                            cnt = 3;
                        }else if(e.star_rating == 'fourStar') {
                            cnt = 4;
                        }else if(e.star_rating == 'fiveStar') {
                            cnt = 5;
                        }else if(e.star_rating == 'S') {
                            collectionPersonRateContent.innerText = e.star_rating;
                        }else if(e.star_rating == 'SR') {
                            collectionPersonRateContent.innerText = e.star_rating;
                        }else {
                            collectionPersonRateContent.innerText = e.star_rating;
                        }

                        for(let i = 0 ; i < cnt ; i++) {
                            const star_icon = document.querySelector("#templete .star_icon").cloneNode(true);
                            collectionPersonRateContent.appendChild(star_icon);
                        }

                        let goalCount = 0;
                        
                        if(e.open_rating == 1) {
                            goalCount = 2;
                        }else if(e.open_rating == 2) {
                            goalCount = 7;
                        }else if(e.open_rating == 3) {
                            goalCount = 14;
                        }else if(e.open_rating == 4) {
                            goalCount = 24;
                        }else if(e.open_rating == 5) {
                            goalCount = 36;
                        }else if(e.open_rating == 6) {
                            goalCount = 49;
                        }else if(e.open_rating == 7) {
                            goalCount = 64;
                        }else if(e.open_rating == 8) {
                            goalCount = 80;
                        }else if(e.open_rating == 9) {
                            goalCount = 100;
                        }

                        const collectionPersonProgress = collectionPersonWrapper.querySelector(".collectionPersonProgress");
                        collectionPersonProgress.style.width = (e.collect_count / goalCount * 100) + "%";
                        // collectionPersonProgress.innerText = e.collect_count + ' / ' + goalCount;
                        
                        if(e.open_rating == 10) {
                            collectionPersonProgress.style.width = "100%";
                            // collectionPersonProgress.innerText = e.collect_count + ' / ∞';
                        }

                        // collectionPersonWrapper.addEventListener("click", asdf);
                        collectionPersonBox.appendChild(collectionPersonWrapper);

                    }

                });

            }
            
            function openMyBag() {

                resetMyBagInput();
                reloadCollectionPersonList();

            }

            function tracking() {
                
                getMyLocation();
                removeMarkedMineMarkers();

                document.getElementById("actionMenuButton").hidden = true;
                document.getElementById("collectionButton").hidden = true;
                document.getElementById("reloadPositionButton").hidden = true;

                const actionCircleOut = document.getElementsByClassName("actionCircleOut");

                for(e of actionCircleOut) {
                    e.style.animation = e.id + 'SpreadIn 0.3s linear 1';
                    e.style.animationFillMode = 'both';
                }

                const actionBackgroundCircle = document.getElementById("actionBackgroundCircle");
                actionBackgroundCircle.style.animation = 'hideBackgroundCircle 0.3s linear 1';
                
                setTimeout(() => {
                    document.getElementById("actionCloseButton").hidden = true;
                    actionBackgroundCircle.hidden = true;
                    for(e of actionCircleOut) {
                        e.hidden = true;
                    }
                    reloadTrackLikeList();
                }, 300);

            }

            function reloadTrackLikeList() {

                const url = "./getTrackLikeList?user_pk=" + user_pk;

                fetch(url)
                .then(response => response.json())
                .then(response => {

                    document.getElementById("trackLikeListHidden").hidden = false;

                    const trackLikeListAnimation = document.getElementById("trackLikeListAnimation");
                    trackLikeListAnimation.style.animation = 'showTrackLikeList 0.2s linear 1';

                    const trackLikeListBox = document.getElementById("trackLikeListBox");
                    trackLikeListBox.innerHTML = "";

                    if(response.data.length == 0) {
                        const noTrackLikeWrapper = document.querySelector("#templete .noTrackLikeWrapper").cloneNode(true);
                        trackLikeListBox.appendChild(noTrackLikeWrapper);
                        return;
                    }

                    for(e of response.data) {

                        const trackLikeListWrapper = document.querySelector("#templete .trackLikeListWrapper").cloneNode(true);

                        trackLikeListWrapper.onclick = () => {
                            trackClosestMark(e);
                        };
                        
                        trackLikeListWrapper.querySelector(".trackLikeListOpenRate").innerText = e.cnt + " / " + e.open_rating;
                        trackLikeListWrapper.querySelector(".trackLikeListNumber").innerText = e.user_more_pk;

                        switch(e.open_rating) {

                            case 10 :
                                trackLikeListWrapper.querySelector(".trackLikeListName").innerText = e.nick_name;
                            case 9 :
                                trackLikeListWrapper.querySelector(".trackLikeListImage").style.background = 
                                    "url(/uploadFiles/" + e.profile_photo + ") no-repeat center";
                                trackLikeListWrapper.querySelector(".trackLikeListImage").style.backgroundSize =
                                    "cover";
                            case 8 : 
                                trackLikeListWrapper.querySelector(".trackLikeListPreference").innerText = e.preference;
                            case 7, 6 : 
                                trackLikeListWrapper.querySelector(".trackLikeListMbtiType").innerText = e.blood_type;
                                trackLikeListWrapper.querySelector(".trackLikeListHobby").innerText = e.hobby;
                            case 5 :
                                trackLikeListWrapper.querySelector(".trackLikeListSmoking").innerText = e.smoking;
                                trackLikeListWrapper.querySelector(".trackLikeListDrinking").innerText = e.drinking;
                            case 4, 3 : 
                                trackLikeListWrapper.querySelector(".trackLikeListHeight").innerText = e.height;
                                trackLikeListWrapper.querySelector(".trackLikeListWeight").innerText = e.weight;
                                trackLikeListWrapper.querySelector(".trackLikeListBloodType").innerText = e.blood_type;
                            case 2: 
                                if(e.gender == 'W') {
                                    // wrapper 성별 자리 만들기
                                }else {
                                    // wrapper 성별 자리 만들기
                                }
                                
                            case 1:
                                // 활동 여부 (온도 형식), 인간 등급 추가

                        }
                        // 추적여부
                        trackLikeListBox.appendChild(trackLikeListWrapper);
                        
                    }

                });
            }

            function hideTrackLikeList() {

                const trackLikeListAnimation = document.getElementById("trackLikeListAnimation");
                trackLikeListAnimation.style.animation = 'hideTrackLikeList 0.3s linear 1';
                trackLikeListAnimation.style.animationFillMode = 'both';

                setTimeout(() => {
                    document.getElementById("trackLikeListHidden").hidden = true;
                }, 500)

                document.getElementById("actionCloseButton").hidden = false;

                const actionBackgroundCircle = document.getElementById("actionBackgroundCircle");
                actionBackgroundCircle.hidden = false;
                actionBackgroundCircle.style.animation = 'showBackgroundCircle 0.3s linear 1';
                

                const actionCircleOut = document.getElementsByClassName("actionCircleOut");

                for(e of actionCircleOut) {
                    e.hidden = false;
                    e.style.animation = e.id + 'SpreadOut 0.4s linear 1';
                    e.style.animationFillMode = 'both';
                }

            }

            function trackClosestMark(e) {

                if(tracingMarkers.length >= 3) {
                    showNoTraceCountAlertModal();
                    return;
                }
                console.log(e.is_track);
                if(e.is_track == 'Y') {
                    showAlreadyTracingAlertModal();
                    return;
                }
                
                const trackLikeListAnimation = document.getElementById("trackLikeListAnimation");
                trackLikeListAnimation.style.animation = 'hideTrackLikeList 0.3s linear 1';
                trackLikeListAnimation.style.animationFillMode = 'both';
                
                setTimeout(() => {
                    document.getElementById("trackLikeListHidden").hidden = true;
                }, 300)

                getClosestMarkLatLng(e.user_pk);
            }

            function getClosestMarkLatLng(userWriterPk) {

                const url = "./getClosestMarkLatLng?user_pk=" + user_pk + "&user_writer_pk=" + userWriterPk + "&latitude=" + currentLat + "&longitude=" + currentLng;

                fetch(url)
                .then(response => response.json())
                .then(response => {
                    
                    if(!response.data) {
                        showNoMakredAlertModal();
                        return;
                    }
                    
                    saveTrackLikeLogInfo(response.data.log_pk, response.data.latitude, response.data.longitude);

                });

            }

            function saveTrackLikeLogInfo(logPk, lat, lng) {

                const url = "./insertTrackLikeLogInfo?user_pk=" + user_pk + "&log_pk=" + logPk +
                    "&markLat=" + lat + "&markLng=" + lng;

                fetch(url)
                .then(response => response.json())
                .then(response => {

                    tracingAnimation(response.data.latitude, response.data.longitude);

                });

            }

            function getTrackingList() {
                
                removeTracingMarkers();

                const url = "./getTrackingList?user_pk=" + user_pk;

                fetch(url)
                .then(response => response.json())
                .then(response => {

                    if(response.data.length == 0) {
                        return;
                    }

                    for(e of response.data) {

                        displayTracingMarker(e);

                    }

                });

            }

            function toggleLike(target) {
                
                const url = "./toggleLike?user_collector_pk=" + user_pk + "&user_writer_pk=" + target.id;

                fetch(url)
                .then(response => response.data)
                .then(response => {
                    openMyBag();
                })

            }

            function showMoreInfoAlertModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#moreInfoAlertModal");
                modal.show();
            }
            
            function showMoreInfoModal() {
                const moreInfoAlertModal = bootstrap.Modal.getOrCreateInstance("#moreInfoAlertModal");
                moreInfoAlertModal.hide();
                const modal = bootstrap.Modal.getOrCreateInstance("#moreInfoModal");
                resetMoreInfoInput();
                modal.show();

                setTimeout(() => {
                    const height = document.querySelector("#moreInfoHeight");
                    height.focus();
                }, 500);
            }

            function showFillAlertModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#fillAlertModal");
                modal.show();

                setTimeout(() => {
                    modal.hide();
                }, 1500);
            }

            function showSuccessMoreInfoAlertModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#successMoreInfoAlertModal");
                modal.show();
                const moreInfoModal = bootstrap.Modal.getOrCreateInstance("#moreInfoModal");
                moreInfoModal.hide();

                setTimeout(() => {
                    modal.hide();
                    showWriteMarkModal();
                }, 1500);

            }

            function showWriteMarkModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#writeMarkModal");
                resetWriteMarkInput();
                modal.show();
            }
            
            function showAllUsedAlertModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#allUsedAlertModal");
                modal.show();

                setTimeout(() => {
                    modal.hide();
                }, 1500);
            }

            function showAlreadyMakredAlertModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#alreadyMakredAlertModal");
                modal.show();

                setTimeout(() => {
                    modal.hide();
                }, 1500);
            }

            let qwer = null;


            function showMarkedModal(e) {
                const modal = bootstrap.Modal.getOrCreateInstance("#showMarkedModal");
                resetShowMarkedInput();
               
                if(user_pk == e.user_pk) {
                    document.getElementById("showMarkedImage").style.background = 
                        "url(/uploadFiles/" + e.image_link + ") no-repeat center";
                    document.getElementById("showMarkedImage").style.backgroundSize = "cover";
                    document.getElementById("showMarkedContent").innerText = e.content;
                    document.getElementById("collectButton").hidden = true;
                    document.getElementById("showMarkedHideContent").hidden = true;
                    document.getElementById("showMarkedHideImage").hidden = true;
                }else {

                    // qwer = aaa(e);

                    // document.getElementById("collectButton").addEventListener("click", qwer);

                    document.getElementById("collectButton").onclick = () => {
                        collectMarkedInfo(e);
                    }

                    document.getElementById("collectButton").hidden = false;
                    document.getElementById("showMarkedHideContent").hidden = false;
                    document.getElementById("showMarkedHideImage").hidden = false;
                }

                modal.show();
            }

            function hideMarkedModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#showMarkedModal");
                modal.hide();

                // if(qwer){
                //     document.getElementById("collectButton").removeEventListener("click", qwer);
                //     qwer = null;
                // }

                
            }

            // function aaa(e){
            //     return () => {
            //         console.log("1111111111111111111111111");
            //         console.log(e);
            //         collectMarkedInfo(e);
            //     }
            // }
            
            function showNoMakredAlertModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#noMakredAlertModal");
                modal.show();

                setTimeout(() => {
                    modal.hide();
                }, 1500);
            }
            
            function showMyBagModal() {
                
                const modal = bootstrap.Modal.getOrCreateInstance("#myBagModal");
                modal.show();
                
                bootstrap.Tab.getOrCreateInstance("#pills-home-tab").show();

                openMyBag();
            }

            function showNoTraceCountAlertModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#noTraceCountAlertModal");
                modal.show();

                setTimeout(() => {
                    modal.hide();
                }, 1500);
            }

            function showAlreadyTracingAlertModal() {
                const modal = bootstrap.Modal.getOrCreateInstance("#alreadyTracingAlertModal");
                modal.show();

                setTimeout(() => {
                    modal.hide();
                }, 1500);
            }

            function resetMoreInfoInput() {
                document.getElementById("moreInfoHeight").value = "";
                document.getElementById("moreInfoWeight").value = "";
                document.getElementById("moreInfoBloodType").value = "";
                document.getElementById("moreInfoMbtiType").value = "";
                document.getElementById("moreInfoHobby").value = "";
                document.getElementById("yesDrink").checked = false;
                document.getElementById("yesSmoke").checked = false;
                document.getElementById("moreInfoPreference").value = 0;
            }

            function resetWriteMarkInput() {
                document.getElementById("writeMarkNoimage").hidden = false;
                document.getElementById("writeMarkImageHere").style.removeProperty("background", "background-size");
                document.getElementById("writeMarkContent").value = "";
            }

            function resetShowMarkedInput() {
                document.getElementById("showMarkedImage").style.removeProperty("background", "background-size");
                document.getElementById("showMarkedContent").innerText = "";
            }

            function resetMyBagInput() {
                document.getElementById("collectionPersonBox").innerHTML = "";
            }

            window.addEventListener("DOMContentLoaded", () => {

                getUserPk();
                createMap();
                getMyLocation();
                
            });

        </script>

        <style>
            .more-info-check:checked {
                background-color: #D96161;
                border-color: #D96161;
            }

            input:invalid {
                background: rgb(217, 97, 97, 0.3);
                border: 2px solid #D96161;
            }

            #markScanCircle{
                position: absolute;
                z-index: 1500;
                border-radius: var(--border-circular);
                background: rgb(0, 0, 0, 0.3);
                width: 44rem;
                height: 44rem;
                top: calc(50% - 22rem);
                left: calc(50% - 22rem);
                animation: markScanCircle 1s linear 3;
                animation-fill-mode: both;
            }
            
            @keyframes markScanCircle {
                from {
                    scale: 0;
                    opacity: 1;
                }
                to {
                    scale: 1;
                    opacity: 0;
                }
            }

            #MarkedMineFirst{
                position: absolute;
                z-index: 1500;
                border-radius: var(--border-circular);
                background: rgb(0, 0, 0, 0.3);
                width: 44rem;
                height: 44rem;
                top: calc(50% - 22rem);
                left: calc(50% - 22rem);
            }

            .markedMineThirdCircle {
                width: var(--myPosition-thirdCircle-diameter);
                height: var(--myPosition-thirdCircle-diameter);
                --myPosition-radius: var(--myPosition-thirdCircle-diameter) / 2;
                background: orange;
            }

            .markedMineSecondCircle {
                width: var(--myPosition-secondCircle-diameter);
                height: var(--myPosition-secondCircle-diameter);
                --myPosition-radius: var(--myPosition-secondCircle-diameter) / 2;
                background: var(--color-white);
                box-shadow: 0 0 2px 2px orange;
            }

            .markedMineFirstCircle {
                width: var(--myPosition-firstCircle-diameter);
                height: var(--myPosition-firstCircle-diameter);
                --myPosition-radius: var(--myPosition-firstCircle-diameter) / 2;
                background: rgb(255, 166, 0, 0.1);
            }

            .star_icon {
                font-variation-settings:
                'FILL' 1
            }

            .overflow-x-auto::-webkit-scrollbar {
                display: none;
            }

            @keyframes showTrackLikeList {
                from {
                    transform: translateY(15rem);
                    opacity: 0;
                    scale: 0;
                }
                to {
                    transform: translateY(0);
                    opacity: 1;
                    scale: 1;
                }
            }

            @keyframes hideTrackLikeList {
                from {
                    transform: translateY(0);
                    opacity: 1;
                    scale: 1;
                }
                to {
                    transform: translateY(15rem);
                    opacity: 0;
                    scale: 0;
                }
            }
        </style>

    </head>

    <body>

        <div class="container-fluid">
            <div class="row">
                <div class="col px-0">
                    <div id="map">
                        <!-- my location -->
                        <div onclick="getMyLocation()" id="reloadPositionButton">
                            <span class="material-symbols-outlined my_location_icon">
                                my_location
                            </span>
                        </div>
                        <!-- my bag -->
                        <div onclick="showMyBagModal()" id="collectionButton">
                            <i class="bi bi-backpack2-fill"></i>
                            <i class="bi bi-gift-fill"></i>
                            <span class="material-symbols-outlined military_tech_icon">
                                military_tech
                            </span>
                        </div>
                        <!-- action -->
                        <div id="actionBackgroundCircle" hidden></div>
                        <div onclick="showActionMenu()" id="actionMenuButton">
                            <span class="material-symbols-outlined pets_icon">
                                pets
                            </span>
                        </div>
                        <div onclick="hideActionMenu()" id="actionCloseButton" class="actionCircleCloseOut" hidden>
                            <div onclick="hideActionMenu()" class="actionCircleCloseIn">
                                <span class="material-symbols-outlined close_icon">
                                    close
                                </span>
                            </div>
                        </div>
                        <div onclick="marking()" id="markButton" class="actionCircleOut markOut" hidden>
                            <div class="action_text">체취</div>
                            <div class="actionCircleIn">
                                <svg class="mark_icon" fill="#5059cd" height="200px" width="200px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 480.001 480.001" xml:space="preserve" stroke="#5059cd" stroke-width="14.400029999999997"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <g> <g> <path d="M288.399,58.009c1.339,0,2.699-0.271,4.004-0.841l9.838-4.305c5.06-2.214,7.366-8.11,5.152-13.17 s-8.111-7.365-13.17-5.152l-9.838,4.305c-5.06,2.214-7.366,8.11-5.152,13.17C280.876,55.77,284.547,58.009,288.399,58.009z"></path> <path d="M325.114,41.949c1.341,0,2.702-0.271,4.009-0.843l0.916-0.401c0.309-0.135,0.607-0.284,0.896-0.446 c0.315-0.102,0.627-0.221,0.936-0.356l0.916-0.401c0.308-0.135,0.606-0.284,0.893-0.445c0.316-0.102,0.631-0.222,0.941-0.358 l0.915-0.401c0.308-0.135,0.605-0.284,0.892-0.445c0.315-0.102,0.627-0.221,0.937-0.356l0.916-0.401 c0.309-0.135,0.607-0.285,0.896-0.447c0.314-0.102,0.627-0.22,0.936-0.356l0.916-0.401c0.308-0.134,0.607-0.284,0.894-0.445 c0.315-0.102,0.629-0.221,0.939-0.357l0.916-0.401c0.309-0.135,0.607-0.285,0.895-0.446c0.314-0.102,0.627-0.221,0.937-0.356 l0.916-0.401c5.059-2.216,7.362-8.114,5.146-13.172c-2.217-5.059-8.115-7.362-13.173-5.146l-0.916,0.401 c-0.309,0.135-0.608,0.285-0.896,0.446c-0.314,0.103-0.627,0.221-0.937,0.357l-0.916,0.401c-0.308,0.135-0.606,0.284-0.893,0.445 c-0.315,0.102-0.629,0.221-0.939,0.358l-0.916,0.401c-0.309,0.135-0.608,0.285-0.896,0.447c-0.314,0.102-0.627,0.22-0.937,0.356 l-0.916,0.401c-0.309,0.135-0.607,0.285-0.896,0.446c-0.315,0.103-0.63,0.222-0.939,0.358l-0.915,0.401 c-0.308,0.135-0.604,0.283-0.891,0.444c-0.315,0.102-0.628,0.221-0.939,0.357l-0.916,0.401c-0.309,0.136-0.607,0.285-0.896,0.446 c-0.315,0.102-0.627,0.221-0.936,0.356l-0.916,0.401c-5.059,2.217-7.362,8.114-5.146,13.173 C317.594,39.712,321.263,41.949,325.114,41.949z"></path> <path d="M365.409,24.303c1.337,0,2.695-0.27,3.998-0.839l9.838-4.298c5.061-2.211,7.372-8.106,5.161-13.167 c-2.213-5.061-8.109-7.371-13.167-5.16l-9.838,4.298c-5.061,2.21-7.372,8.105-5.161,13.167 C357.883,22.062,361.554,24.303,365.409,24.303z"></path> <path d="M378.55,147.207l-9.568-4.912c-4.91-2.521-10.941-0.583-13.463,4.33c-2.522,4.913-0.584,10.941,4.33,13.463l9.568,4.912 c1.461,0.75,3.022,1.105,4.559,1.105c3.63,0,7.133-1.983,8.904-5.435C385.403,155.757,383.465,149.73,378.55,147.207z"></path> <path d="M342.926,128.901l-0.89-0.456c-0.3-0.154-0.604-0.291-0.91-0.412c-0.278-0.18-0.568-0.348-0.869-0.502l-0.89-0.456 c-0.3-0.154-0.603-0.291-0.91-0.412c-0.278-0.18-0.568-0.348-0.869-0.502l-0.89-0.456c-0.3-0.154-0.604-0.291-0.91-0.412 c-0.278-0.18-0.568-0.348-0.869-0.502l-0.89-0.457c-0.3-0.154-0.604-0.291-0.91-0.412c-0.278-0.18-0.568-0.348-0.869-0.502 l-0.89-0.457c-0.3-0.154-0.603-0.291-0.91-0.412c-0.278-0.18-0.568-0.348-0.869-0.502l-0.89-0.457 c-0.299-0.153-0.602-0.29-0.907-0.411c-0.279-0.18-0.569-0.348-0.871-0.503l-0.89-0.456c-0.3-0.154-0.604-0.291-0.91-0.412 c-0.279-0.181-0.57-0.349-0.872-0.504l-0.424-0.217c-4.915-2.519-10.942-0.579-13.461,4.337 c-2.52,4.914-0.578,10.941,4.336,13.461l0.424,0.217c0.299,0.153,0.602,0.29,0.907,0.41c0.278,0.18,0.568,0.348,0.869,0.502 l0.89,0.457c0.299,0.153,0.602,0.29,0.907,0.411c0.279,0.18,0.569,0.348,0.871,0.503l0.89,0.457 c0.3,0.154,0.603,0.291,0.91,0.412c0.278,0.18,0.568,0.348,0.869,0.502l0.89,0.456c0.3,0.154,0.603,0.291,0.91,0.412 c0.278,0.18,0.568,0.348,0.869,0.502l0.89,0.456c0.3,0.154,0.604,0.291,0.91,0.412c0.278,0.18,0.568,0.348,0.869,0.502 l0.89,0.456c0.3,0.154,0.604,0.291,0.91,0.412c0.278,0.18,0.568,0.348,0.869,0.502l0.89,0.457c0.3,0.154,0.603,0.291,0.91,0.412 c0.278,0.18,0.568,0.348,0.869,0.502l0.89,0.457c1.461,0.75,3.021,1.105,4.558,1.105c3.63,0,7.133-1.984,8.904-5.437 C349.779,137.45,347.841,131.422,342.926,128.901z"></path> <path d="M303.798,108.812l-9.539-4.911c-4.908-2.528-10.94-0.598-13.468,4.313c-2.528,4.911-0.597,10.941,4.313,13.468 l9.539,4.911c1.465,0.754,3.027,1.111,4.569,1.111c3.625,0,7.125-1.979,8.898-5.424 C310.639,117.369,308.708,111.34,303.798,108.812z"></path> <path d="M296.66,68.209c-5.522,0-10,4.477-10,10s4.478,10,10,10h10.736c5.522,0,10-4.477,10-10s-4.478-10-10-10H296.66z"></path> <path d="M347.552,68.209c-0.338,0-0.671,0.017-1,0.049c-0.329-0.033-0.662-0.049-1-0.049h-1c-0.338,0-0.671,0.017-1,0.049 c-0.329-0.033-0.662-0.049-1-0.049h-1c-0.338,0-0.671,0.017-1,0.049c-0.329-0.033-0.662-0.049-1-0.049h-1 c-0.338,0-0.671,0.017-1,0.049c-0.329-0.033-0.662-0.049-1-0.049h-1c-0.338,0-0.671,0.017-1,0.049 c-0.329-0.033-0.662-0.049-1-0.049h-1c-5.522,0-10,4.477-10,10s4.478,10,10,10h1c0.338,0,0.671-0.017,1-0.049 c0.329,0.033,0.662,0.049,1,0.049h1c0.338,0,0.671-0.017,1-0.049c0.329,0.033,0.662,0.049,1,0.049h1c0.338,0,0.671-0.017,1-0.049 c0.329,0.033,0.662,0.049,1,0.049h1c0.338,0,0.671-0.017,1-0.049c0.329,0.033,0.662,0.049,1,0.049h1c0.338,0,0.671-0.017,1-0.049 c0.329,0.033,0.662,0.049,1,0.049h0.505c5.522,0,10-4.477,10-10s-4.478-10-10-10H347.552z"></path> <path d="M381.023,68.209H370.3c-5.522,0-10,4.477-10,10s4.478,10,10,10h10.723c5.522,0,10-4.477,10-10 S386.546,68.209,381.023,68.209z"></path> <path d="M216.457,142.399v-6.095h32.959c5.522,0,10-4.477,10-10V40.377c0-5.523-4.478-10-10-10H163.48c-5.522,0-10,4.477-10,10 v85.928c0,5.523,4.478,10,10,10h32.977v6.111c-63.738,5.007-107.408,57.95-107.408,132.191v75.445 c-0.093,0.805-0.098,1.603,0,2.377v117.572c0,5.523,4.478,10,10,10h214.816c5.522,0,10-4.477,10-10v-163.93 c0-0.011,0-0.025,0-0.038v-31.426c0-36.194-10.872-69.244-30.613-93.061C273.871,158.164,247.472,144.753,216.457,142.399z M173.48,116.305V50.377h65.936v22.997c-0.244-0.018-0.488-0.037-0.736-0.037h-21.486c-5.522,0-10,4.477-10,10s4.478,10,10,10 h21.486c0.248,0,0.492-0.02,0.736-0.037v23.005H173.48z M303.865,460.002H109.049v-22.96h194.816V460.002z M303.866,417.042 L303.866,417.042H109.049v-65.204c0.845-3.798,4.069-16.559,11.624-28.996c11.16-18.376,26.47-27.694,45.503-27.694 c6.992,0,11.729,1.453,14.479,4.441c6.168,6.703,4.782,23.359,3.559,38.055c-1.498,17.997-3.047,36.607,7.155,48.204 c5.154,5.859,12.494,9.042,21.813,9.458c1.333,0.06,2.657,0.09,3.982,0.09c29.224-0.002,56.629-14.504,79.474-42.132 c2.605-3.151,5.011-6.305,7.228-9.397V417.042z M303.865,304.136c-4.98,11.092-35.537,73.637-89.79,71.191 c-5.543-0.248-7.159-2.085-7.69-2.689c-4.581-5.207-3.338-20.15-2.24-33.333c1.641-19.713,3.337-40.097-8.774-53.257 c-6.654-7.231-16.477-10.898-29.195-10.898c-23.087,0-42.656,10.063-57.127,29.232v-29.773 c0-56.041,30.119-112.586,97.408-112.586s97.408,56.545,97.408,112.585V304.136z"></path> </g> </g> </g> </g></svg>
                            </div>
                        </div>
                        <div onclick="scaning()" id="scanButton" class="actionCircleOut scanOut" hidden>
                            <div class="action_text">시향</div>
                            <div class="actionCircleIn">
                                <svg class="scan_icon" viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" fill="#5059cd" stroke="#5059cd" stroke-width="20.48"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path fill="#fff" d="M18 18v34.924C30.373 40.596 43.205 29.082 56.232 18H18zm66.443 0C61.258 37.103 38.673 56.716 18 79.066v93.604c35.238-62.356 85.948-121.868 169.047-154.234L186.71 18H84.442zm96.07 22.428C97.444 77.27 50.832 143.66 18 210.878v64.858c11.154.898 21.737 2.696 31.846 5.455-4.82-7.28-8.926-14.836-11.254-22.258-3.256-10.382-2.62-22.698-1.78-33.282.842-10.583 2.317-19.17 2.317-19.17l17.74 3.04s-1.342 7.86-2.114 17.558c-.772 9.7-.545 21.504 1.012 26.467 2.876 9.17 13.302 24.353 23.015 36.187a327.014 327.014 0 0 0 4.016 4.79c7.474 4.124 14.704 8.94 21.745 14.48 33.96 26.73 63.706 69.267 99.367 130.902 16.65 6.505 40.976 9.85 64.414 10.405a36.37 36.37 0 0 1-2.592-4.486c-4.572-9.458-4.285-22.07 3.704-31.392 7.562-8.826 17.962-18.636 30.61-24.358 5.532-2.503 11.77-4.057 18.153-4.12.076-.002.15.005.226.005l-18.238-62.606c-3.994-9.02-4.22-18.422-2.325-26.89 1.95-8.702 5.86-16.646 10.035-24.292 8.34-15.268 17.522-29.612 18.94-42.438 2.55-26.62-12.78-47.528-24.22-74.013l-1.08-2.5.49-2.683c7.444-40.794 33.434-74.835 60.376-109.16-49.54-4.95-111.124 15.353-158.06 29.514l-7.61 2.297-3.218-7.27c-4.085-9.22-8.42-17.702-13.002-25.49zm119.674 282.926c.112.25.215.503.333.753l-.49-1.293.158.54zm79.655-258.51a163.5 163.5 0 0 0-13.22.51c-21.75 28.594-40.064 56.13-46.23 85.808.794 1.755 1.635 3.52 2.495 5.293 24.865-33.377 53.62-65.993 96.406-87.627-14.438-2.722-27.53-3.96-39.45-3.984zm-156.03 130.77l17.323 4.886c-2.18 7.726.64 20.587 8.457 32.105 7.816 11.52 20.036 21.37 33.588 24.864l-4.494 17.428c-18.755-4.836-34.023-17.498-43.99-32.185-9.965-14.687-15.22-31.725-10.885-47.098zM353.845 295.67l-4.797 84.873 21.817-62.324-17.02-22.55zm72.394 29.07l-51.172 66.15s78.346-26.13 82.184-27.158c3.838-1.028-31.012-38.992-31.012-38.992zm38.672 77.076l-74.24 14.653 76.183 6.735-1.943-21.39zm-143.662.543c6.196 36.786-13.185 38.92-33.77 42.212 8.924 2.434 37.68 6.205 45.69-6.953 6.452-10.598-5.676-27.313-11.92-35.26zm54.396 42.716l39.526 25.824 44.13-15.67-83.656-10.154zM18 471v18h476v-18H18z"></path></g></svg>
                            </div>
                        </div>
                        <div onclick="tracking()" id="trackButton" class="actionCircleOut trackOut" hidden>
                            <div class="action_text">추행</div>
                            <div class="actionCircleIn">
                                <svg class="track_icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" fill="#5059cd" transform="rotate(0)"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"> <g> <path fill="none" d="M0 0h24v24H0z"></path> <path d="M4 18h5.5v1.25a2.75 2.75 0 1 1-5.5 0V18zm4.058-4l.045-.132C8.87 11.762 9 11.37 9 11c0-.75-.203-1.643-.528-2.273C8.23 8.257 8.06 8.12 8 8.12 6.72 8.12 5.5 9.484 5.5 11c0 .959.075 1.773.227 2.758l.038.242h2.293zM8 6.12c2 0 3 2.88 3 4.88 0 1-.5 2-1 3.5L9.5 16H4c0-1-.5-2.5-.5-5S5.498 6.12 8 6.12zm12.054 7.978l-.217 1.231a2.75 2.75 0 0 1-5.417-.955l.218-1.23 5.416.954zm-1.05-4.246c.165-.5.301-.895.303-.9.202-.658.361-1.303.485-2.008.263-1.492-.702-3.047-1.962-3.27-.059-.01-.25.095-.57.515-.43.565-.784 1.41-.915 2.147-.058.33-.049.405.27 2.263.045.256.082.486.116.717l.02.138 2.254.398zm-.826-8.147c2.464.434 4.018 3.124 3.584 5.586-.434 2.463-1.187 3.853-1.36 4.838l-5.417-.955-.232-1.564c-.232-1.564-.55-2.636-.377-3.62.347-1.97 1.832-4.632 3.802-4.285z"></path> </g> </g></svg>
                            </div>
                        </div>
                        <div id="trackLikeListHidden" class="row" hidden>
                            <div class="col">
                                <div id="trackLikeListAnimation" class="row bg-transparent overflow-x-auto" style="width: 95%; position: absolute; z-index: 2000; top: 55%; left: 5.5%;">
                                    <div class="col">
                                        <div id="trackLikeListBox" class="row d-flex" style="flex-wrap: nowrap;">
                                            
                                            <!-- wrapper -->
                                                                                        
                                        </div>
                                    </div>
                                </div>
                                <div onclick="hideTrackLikeList()" id="trackLikeListCloseButton" class="actionCircleCloseOut">
                                    <div class="actionCircleCloseIn">
                                        <span class="material-symbols-outlined close_icon">
                                            close
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- <div style="width: 100%; height: 23vh; position: absolute; z-index: 1500; top: 75%;"></div> -->
                    </div>
                </div>
            </div>
            <div class="row fixed-bottom">
                <div class="col bg-white" style="height: 41px;"></div>
            </div>
        </div>

        <div id="moreInfoAlertModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2100; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body text-center" style="font-size: 0.9rem;">
                        <p class="mb-0">😍 체취를 처음 남기실 경우 <span style="color: #D96161;">추가 정보</span>를 입력해 주셔야 합니다</p>
                        <!-- <p class="mb-0">추가 정보는 수집하는 누군가가 확인할 수 있습니다</p>
                        <p class="mb-0">민감한 개인정보는 다루지 않으니 안심하셔도 됩니다</p>
                        <p class="mb-0">전 문항을 양심에 따라 솔직히 입력해 주시기 바랍니다</p> -->
                    </div>
                    <div class="modal-footer pt-0 pb-2 border-0 justify-content-center">
                        <button type="button" class="btn btn-secondary py-1" data-bs-dismiss="modal">닫기</button>
                        <button onclick="showMoreInfoModal()" class="btn py-1 text-white" style="background: #D96161;">추가정보 입력</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="fillAlertModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2200; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content mx-auto text-white" style="width: 50%; background: #D96161;">
                    <div class="modal-body text-center" style="font-size: 0.9rem;">
                        빈칸을 모두 채워주세요
                    </div>
                </div>
            </div>
        </div>

        <div id="successMoreInfoAlertModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2200; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content mx-auto text-white" style="width: 50%; background: #D96161;">
                    <div class="modal-body text-center" style="font-size: 0.9rem;">
                        등록이 완료되었습니다
                    </div>
                </div>
            </div>
        </div>

        <div id="allUsedAlertModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2200; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content mx-auto text-white" style="width: 50%; background: #D96161;">
                    <div class="modal-body text-center" style="font-size: 0.9rem;">
                        횟수를 전부 사용하셨습니다
                    </div>
                </div>
            </div>
        </div>

        <div id="alreadyMakredAlertModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2200; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-lg modal-dialog-centered">
                <div class="modal-content mx-auto text-white" style="width: 50%; background: #D96161;">
                    <div class="modal-body text-center" style="font-size: 0.9rem;">
                        근처에 이미 체취를 남기셨습니다
                    </div>
                </div>
            </div>
        </div>

        <div id="noMakredAlertModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2200; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content mx-auto text-white" style="width: 50%; background: #D96161;">
                    <div class="modal-body text-center" style="font-size: 0.9rem;">
                        채취가 없습니다
                    </div>
                </div>
            </div>
        </div>

        <div id="noTraceCountAlertModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2200; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content mx-auto text-white" style="width: 50%; background: #D96161;">
                    <div class="modal-body text-center" style="font-size: 0.9rem;">
                        추행 횟수를 모두 사용하셨습니다
                    </div>
                </div>
            </div>
        </div>

        <div id="alreadyTracingAlertModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2200; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-sm modal-dialog-centered">
                <div class="modal-content mx-auto text-white" style="width: 50%; background: #D96161;">
                    <div class="modal-body text-center" style="font-size: 0.9rem;">
                        이미 추행하고 있는 사람입니다
                    </div>
                </div>
            </div>
        </div>

        <div id="moreInfoModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2100; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col ps-4 pe-5">
                                <div class="row">
                                    <div class="col text-center fw-bold" style="font-size: 1.3rem;">
                                        추가 정보
                                    </div>
                                </div>
                                <div class="row mt-3">
                                    <div class="col-3 text-end">신장</div>
                                    <div class="col">
                                        <div class="input-group">
                                            <input id="moreInfoHeight" class="form-control py-1 rounded text-end" type="number" min="140" max="200" style="box-shadow: none; font-size: 0.8rem;" placeholder="소수점 제외 | 140~200">
                                            <span class="ms-2">cm</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3 text-end">몸무게</div>
                                    <div class="col">
                                        <div class="input-group">
                                            <input id="moreInfoWeight" class="form-control py-1 rounded text-end" type="number" min="30" max="200" style="box-shadow: none; font-size: 0.8rem;" placeholder="소수점 제외 | 30~200">
                                            <span class="ms-2">kg</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3 text-end">혈액형</div>
                                    <div class="col">
                                        <div class="input-group">
                                            <input id="moreInfoBloodType" oninput="textToUpperCase(this)" class="form-control py-0 rounded text-end" type="text" style="text-transform: uppercase; box-shadow: none;" pattern="A|B|AB|O" maxlength="2">
                                            <span class="ms-2">형</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3 text-end">MBTI</div>
                                    <div class="col">
                                        <input id="moreInfoMbtiType" oninput="textToUpperCase(this)" class="form-control py-0 rounded" type="text" style="text-transform: uppercase; box-shadow: none;" pattern="ESTJ|ESTP|ESFJ|ESFP|ENTJ|ENTP|ENFJ|ENFP|ISTJ|ISTP|ISFJ|ISFP|INTJ|INTP|INFJ|INFP" maxlength="4">
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3 text-end">취미</div>
                                    <div class="col">
                                        <div class="input-group">
                                            <input id="moreInfoHobby" class="form-control py-0 rounded" type="text" maxlength="10" style="box-shadow: none;">
                                            <span class="ms-2 mt-3" style="font-size: 0.65rem;">최대 10글자 이내</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3 text-end">음주여부</div>
                                    <div class="col">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input more-info-check moreInfoDrink" type="radio" name="isDrink" id="yesDrink" value="Y" style="box-shadow: none;">
                                            <label class="form-check-label" for="yesDrink">Y</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input more-info-check moreInfoDrink" type="radio" name="isDrink" id="noDrink" value="N" style="box-shadow: none;" checked>
                                            <label class="form-check-label" for="noDrink">N</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3 text-end">흡연여부</div>
                                    <div class="col">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input more-info-check moreInfoSmoke" type="radio" name="isSmoke" id="yesSmoke" value="Y" style="box-shadow: none;">
                                            <label class="form-check-label" for="yesSmoke">Y</label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input more-info-check moreInfoSmoke" type="radio" name="isSmoke" id="noSmoke" value="N" style="box-shadow: none;" checked>
                                            <label class="form-check-label" for="noSmoke">N</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col-3 text-end">지향</div>
                                    <div class="col">
                                        <select id="moreInfoPreference" class="form-select py-0" style="box-shadow: none;">
                                            <option hidden selected value="0">
                                                선택해주세요
                                            </option>
                                            <option value="L">이성애</option>
                                            <option value="B">게이</option>
                                            <option value="G">레즈비언</option>
                                            <option value="V">바이섹슈얼</option>
                                            <option value="A">에이섹슈얼</option>
                                            <option value="D">데미섹슈얼</option>
                                            <option value="P">팬섹슈얼</option>
                                            <option value="q">퀘스처닝</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer pb-2 border-0 justify-content-center">
                        <button type="button" class="btn btn-secondary py-1" data-bs-dismiss="modal">닫기</button>
                        <button onclick="saveMoreInfo()" class="btn py-1 text-white" style="background: #D96161;">저장하기</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="writeMarkModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2100; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col">
                                <div class="row">
                                    <div onclick="inputImage()" onchange="previewImage()" id="writeMarkImageHere" class="col border rounded-pill mx-3 px-0" style="aspect-ratio: 4/3;">
                                        <!-- hidden -->
                                        <div id="writeMarkNoimage" class="row text-center align-items-center" style="height: 100%;">
                                            <div class="col">
                                                <div class="row">
                                                    <div class="col">
                                                        <span class="material-symbols-outlined" style="color: #BFBFBF; font-size: 2rem;">
                                                            add_photo_alternate
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col" style="color: #BFBFBF; font-size: 1rem;">
                                                        이미지 추가하기
                                                    </div>
                                                </div>
                                                <input id="writeMarkImage" type="file" accept="image/*" hidden>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-4">
                                    <div class="col">
                                        <span class="material-symbols-outlined align-middle" style="font-size: 1.1rem;">
                                            stylus_note
                                        </span>
                                        한줄글
                                    </div>
                                </div>
                                <div class="row">
                                    <div id="ggg" class="col"></div>
                                </div>
                                <div class="row">
                                    <div id="hhh" class="col"></div>
                                </div>
                                <div class="row">
                                    <div id="jjj" class="col"></div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col">
                                        <textarea id="writeMarkContent" class="form-control" rows="2" placeholder="체취와 함께 흔적을 남겨주세요"></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer pb-2 border-0 justify-content-center">
                        <button type="button" class="btn btn-secondary py-1" data-bs-dismiss="modal">닫기</button>
                        <button onclick="saveWriteMarkInfo()" class="btn py-1 text-white" style="background: #D96161;">체취등록</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="showMarkedModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 2100; background: rgb(0, 0, 0, 0.4);">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col">
                                <div class="row">
                                    <div id="showMarkedImage" class="col border rounded-pill mx-3 px-0" style="aspect-ratio: 4/3;">
                                        <div id="showMarkedHideImage" class="row text-center align-items-center" style="height: 100%;" hidden>
                                            <div class="col">
                                                <div class="row">
                                                    <div class="col" style="color: #BFBFBF; font-size: 1rem;">
                                                        ? ? ?
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-4">
                                    <div class="col">
                                        <span class="material-symbols-outlined align-middle" style="font-size: 1.1rem;">
                                            stylus_note
                                        </span>
                                        한줄글
                                    </div>
                                </div>
                                <div class="row mt-2">
                                    <div class="col">
                                        <span id="showMarkedContent"></span>
                                        <span id="showMarkedHideContent" style="color: #BFBFBF; font-size: 1rem;" hidden>?????</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer pb-2 border-0 justify-content-center">
                        <button onclick="hideMarkedModal()" type="button" class="btn btn-secondary py-1">닫기</button>
                        <button id="collectButton" class="btn py-1 text-white" style="background: #D96161;" hidden>수집하기</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="myBagModal" class="modal fade" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true" style="z-index: 3000; background: rgb(138, 142, 184);">
            <div class="modal-dialog modal-fullscreen">
                <div class="modal-content mx-auto" style="width: 97%;">
                    <div class="modal-body">
                        <div class="row">
                            <div class="col">
                                <ul class="nav nav-underline nav-fill" id="pills-tab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">꾸욱 List</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">수집도감</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">내 체취/흔적</button>
                                    </li>
                                </ul>
                                <div class="tab-content" id="pills-tabContent">
                                    <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab" tabindex="0">
                                        <div class="row">
                                            <div class="col">
                                                <div class="row">
                                                    <div class="col text-center">
                                                        <span class="material-symbols-outlined" style="font-size: 5rem; color: #BFBFBF;">
                                                            engineering
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col text-center">
                                                        <span class="material-symbols-outlined" style="font-size: 1.1rem; color: #BFBFBF;">
                                                            서비스 준비 중
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab" tabindex="0">
                                        <div class="row">
                                            <div class="col">
                                                <div id="collectionPersonBox" class="row row-cols-3 px-4">

                                                    <!-- wrapper -->
                                                    
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab" tabindex="0">
                                        <div class="row">
                                            <div class="col">
                                                <div class="row">
                                                    <div class="col text-center">
                                                        <span class="material-symbols-outlined" style="font-size: 5rem; color: #BFBFBF;">
                                                            engineering
                                                        </span>
                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col text-center">
                                                        <span class="material-symbols-outlined" style="font-size: 1.1rem; color: #BFBFBF;">
                                                            서비스 준비 중
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="actionCircleCloseOut" data-bs-dismiss="modal" style="position: fixed;">
                            <div class="actionCircleCloseIn">
                                <span class="material-symbols-outlined close_icon">
                                    close
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="templete" class="d-none">
            <div class="collectionPersonWrapper col px-4 mt-5">
                <div class="row">
                    <div class="collectionPersonRateCircle col mx-3 d-grid align-items-center" style="aspect-ratio: 1/1; border-radius: 50%; border: 1px solid #40BAE5;">
                        <div class="row">
                            <div class="collectionPersonImage col mx-1 text-center fw-bold d-grid align-items-center" style="aspect-ratio: 1/1; border-radius: 50%; border: 1px solid #BFBFBF; color: #BFBFBF;">
                                ???
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-1">
                    <div class="collectionPersonRateContent col px-1 text-center" style="word-spacing: -1rem;">
                        
                    </div>
                </div>
                <div class="row">
                    <div class="col px-2 mt-1">
                        <div class="progress" role="progressbar" style="height: 0.5rem;">
                            <div class="collectionPersonProgress progress-bar text-bg-warning" style="width: 75%; font-size: 0.6rem;"></div>
                        </div>
                    </div>
                    <div class="col-auto px-0 d-grid align-text-top">
                        <i onclick="toggleLike(this)" class="likeHeart bi bi-heart" style="font-size: 0.7rem; color: #D96161;"></i>
                    </div>
                </div>
            </div>

            <span class="star_icon material-symbols-outlined" style="font-size: 0.8rem;">
                star_rate
            </span>

            <div class="trackLikeListWrapper col-11 me-2 px-3 py-2 border bg-white border border-secondary-subtle rounded">
                <div class="row align-items-center">
                    <div class="col-4">
                        <div class="row">
                            <div class="col" style="font-size: 0.7rem;">
                                NO.<span class="trackLikeListNumber"></span>
                            </div>
                        </div>
                        <div class="row justify-content-center">
                            <div class="trackLikeListImage col-10 border text-center d-grid align-items-center bg-white text-body-tertiary rounded" style="aspect-ratio: 1/1;">
                                ???
                            </div>
                        </div>
                        <div class="row mt-1">
                            <div class="col fw-bold" style="font-size: 0.8rem;">
                                <span class="trackLikeListName">?????</span> / (<span class="trackLikeListOpenRate">7 / 23</span>)
                            </div>
                        </div>
                    </div>
                    <div class="col" style="font-size: 0.8rem; position: relative;">
                        <div class="row">
                            <div class="col">키 | <span class="trackLikeListHeight">???</span> cm</div>
                            <div class="col">몸무게 | <span class="trackLikeListWeight">???</span> kg</div>
                        </div>
                        <div class="row mt-1">
                            <div class="col">혈액형 | <span class="trackLikeListBloodType">???</span></div>
                            <div class="col">MBTI | <span class="trackLikeListMbtiType">???</span></div>
                        </div>
                        <div class="row mt-1">
                            <div class="col">음주여부 | <span class="trackLikeListDrinking">???</span></div>
                            <div class="col">흡연여부 | <span class="trackLikeListSmoking">???</span></div>
                        </div>
                        <div class="row mt-1">
                            <div class="col">취미 | <span class="trackLikeListHobby">?????</span></div>
                        </div>
                        <div class="row mt-1">
                            <div class="col">취향 | <span class="trackLikeListPreference">?????</span></div>
                        </div>
                        <div style="position: absolute; top: 70%; right: 10%; width: 4rem; height: 4 / 3rem;">
                            <img class="img-fluid" th:src="@{/public/image/follow/dogfoot.png}">
                        </div>
                    </div>
                </div>
            </div>

            <div class="noTrackLikeWrapper col-12 me-2 px-3 py-5 border bg-white border border-secondary-subtle rounded" style="background: url(https://svgsilh.com/svg/2051093-b6a4a4.svg) no-repeat center; background-size: contain;">
                <div class="row">
                    <div class="col text-center">
                        <div class="row">
                            <div class="col">
                                <span class="material-symbols-outlined text-body-tertiary" style="font-size: 1.5rem;">
                                    cardiology
                                </span>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col text-body-tertiary" style="font-size: 1.1rem;">
                                꾸욱 누른 사람이 없습니다
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <style>
            .overlayBox {position: relative; width: 5rem; height: 14rem; animation: opacity 0.1s, vibration 0.1s 5;}
            .circleProp {position: absolute; top: calc(50% - 0.15rem); left: calc(50% - 0.5rem); width: 1rem; height: 0.3rem; border-radius: 50%; background: black;}
            .lineProp {position: absolute; z-index: 1; left: calc(50% - 0.05rem); top: calc(50% - 2rem); width: 0.1rem; height: 2rem; background: #BFBFBF;}
            .squareProp {position: absolute; z-index: 2; left: calc(50% - 1rem); top: calc(50% - 2.3rem); width: 2rem; height: 0.7rem;}
            .topSquareProp {position: absolute; left: 0.25rem; width: 1.5rem; height: 0.5rem; transform: skew(-45deg); background: black;}
            .frontSquareProp {position: absolute; bottom: 0; width: 1.5rem; height: 0.2rem; background: #CCC;}
            .sideSquareProp {position: absolute; right: 0.03rem; bottom: 0.25rem; width: 0.5rem; height: 0.2rem; background: #8f8f8f; transform: skewY(-45deg);}
            .myMarkCircleBox {position: absolute; z-index: 3; width: 5rem; height: 5rem; top: calc(50% - 6.9rem); animation: trunning 1s;}
            .myMarkCircle {position: absolute; border-radius: 50%;}
            /* conic-gradient(transparent 20deg, darkcyan 20deg 70deg, transparent 70deg 200deg, darkcyan 200deg 250deg, transparent 250deg) */
            .myMarkCircle.first {width: 5rem; height: 5rem; left: calc(50% - 2.5rem); top: calc(50% - 2.5rem); padding: 0.15rem; background:conic-gradient(transparent 20deg, tomato 20deg 60deg, transparent 60deg 200deg, tomato 200deg 240deg, transparent 240deg); mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); mask-composite: exclude; box-shadow: 0.5px 0.5px 0 0.5px rgb(81, 81, 81);}
            .myMarkCircle.second {width: 4.6rem; height: 4.6rem; border: 0.4rem solid tomato; left: calc(50% - 2.3rem); top: calc(50% - 2.3rem);}
            .myMarkCircle.third {width: 4.4rem; height: 4.4rem; border: 0.15rem solid pink; left: calc(50% - 2.2rem); top: calc(50% - 2.2rem); box-shadow: 0.5px 0.5px 0 0.5px rgb(81, 81, 81);}
            .myMarkCircle.fourth {width: 3.5rem; height: 3.5rem; left: calc(50% - 1.75rem); top: calc(50% - 1.75rem); padding: 0.15rem; background:conic-gradient(transparent 110deg, tomato 110deg 150deg, transparent 150deg 260deg, tomato 260deg 350deg, transparent 350deg); mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); mask-composite: exclude; box-shadow: 0.5px 0.5px 0 0.5px rgb(81, 81, 81);}
            .myMarkCircle.fifth {width: 3rem; height: 3rem; left: calc(50% - 1.5rem); top: calc(50% - 1.5rem); background: white; border: 0.15rem solid tomato; font-size: 0.9rem; box-shadow: 0.5px 0.5px 0 0.5px rgb(81, 81, 81);}

            @keyframes opacity {
                from {
                    scale: 5;
                    opacity: 0;
                }
                to {
                    scale: 1;
                    opacity: 1;
                }
            }

            @keyframes vibration {
                from {
                    transform: rotate(1deg);
                }
                to {
                    transform: rotate(-1deg);
                }
            }

            @keyframes trunning {
                from {
                    scale: 0;
                    transform: rotateY(0);
                }
                to {
                    scale: 1;
                    transform: rotateY(720deg);
                }
            }

            .walkingPawCircle {position: relative; width: 2rem; height: 2rem; border: 1px solid transparent; border-radius: 50%;}
            .walkingPawIcon {position: absolute; color: rgb(0, 0, 0);}
            .walkingPawIcon.first {top: calc(50% - 3rem); left: calc(50% - 1.5rem); transform: rotate(-5deg); opacity: 0; animation: showSomthing 1s, hideSomthing 0.5s 1s; animation-fill-mode: forwards;}
            .walkingPawIcon.second {top: calc(50% - 4rem); right: calc(50% - 1.5rem); transform: rotate(5deg); opacity: 0; animation: showSomthing 1s 0.3s, hideSomthing 0.5s 1.3s linear 1; animation-fill-mode: forwards;}
            .walkingPawIcon.third {top: calc(50% - 5rem); left: calc(50% - 1.5rem); transform: rotate(-5deg); opacity: 0; animation: showSomthing 1s 0.6s, hideSomthing 0.5s 1.6s linear 1; animation-fill-mode: forwards;}
            .walkingPawIcon.fourth {top: calc(50% - 6rem); right: calc(50% - 1.5rem); transform: rotate(5deg); opacity: 0; animation: showSomthing 1s 0.9s, hideSomthing 0.5s 1.9s linear 1; animation-fill-mode: forwards;}
            .walkingPawIcon.fifth {top: calc(50% - 7rem); left: calc(50% - 1.5rem); transform: rotate(-5deg); opacity: 0; animation: showSomthing 1s 1.2s, hideSomthing 0.5s 2.2s linear 1; animation-fill-mode: forwards;}
            .walkingPawIcon.sixth {top: calc(50% - 8rem); right: calc(50% - 1.5rem); transform: rotate(5deg); opacity: 0; animation: showSomthing 1s 1.5s, hideSomthing 0.5s 2.5s linear 1; animation-fill-mode: forwards;}
            .walkingPawIcon.seventh {top: calc(50% - 9rem); left: calc(50% - 1.5rem);transform: rotate(-5deg); opacity: 0; animation: showSomthing 1s 1.8s, hideSomthing 0.5s 2.8s linear 1;animation-fill-mode: forwards;}

        </style>

        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=a277eb582a644847f86de6196a42745f"></script>
        <script>

            let myMarker;

            function createMap() {
                const mapContainer = document.getElementById("map");
                mapOption = {
                    center: new kakao.maps.LatLng(staticLat, staticLng),
                    // center: new kakao.maps.LatLng(33.450701, 126.570667),
                    level: 4
                };

                map = new kakao.maps.Map(mapContainer, mapOption);

            }

            function getMyLocation() {
                if(navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition((position) => {

                        currentLat = position.coords.latitude;
                        currentLng = position.coords.longitude;

                        let currentPosition = new kakao.maps.LatLng(currentLat, currentLng)

                        displayMarker(currentPosition);
                    });
                }else {
                    let staticPosition = new kakao.maps.LatLng(staticLat, staticLng);

                    displayMarker(staticPosition);
                }
            }

            function displayMarker(locPosition) {
                if(!myMarker) {
                    var content = '<div id="firstCircle" class="myPosition">' + 
                        '<div id="secondCircle" class="myPosition">' + 
                        '<div id="thirdCircle" class="myPosition">' + 
                        '</div></div></div>';
                    
                    myMarker = new kakao.maps.CustomOverlay({
                        position: locPosition,
                        content: content
                    });
                }else {
                    myMarker.setPosition(locPosition);
                }
                myMarker.setMap(map);
                map.panTo(locPosition);
            }

            function markedScan() {
                
                var content = '<div id="markScanCircle"></div>';
                var position = new kakao.maps.LatLng(currentLat, currentLng);

                var customOverlay = new kakao.maps.CustomOverlay({
                    position: position,
                    content: content
                });

                customOverlay.setMap(map);

                setTimeout(() => {
                    customOverlay.setMap(null);
                }, 3000);
            }

            function displayMarkedMine(position, e) {
                // const content = document.createElement('div');
                // content.setAttribute("class", "myPosition markedMineFirstCircle");
                // const div2 = document.createElement('div');
                // div2.setAttribute("class", "myPosition markedMineSecondCircle");
                // const div3 = document.createElement('div');
                // div3.setAttribute("class", "myPosition markedMineThirdCircle");

                // div2.appendChild(div3);
                // content.appendChild(div2);

                var content = document.createElement('div');
                content.setAttribute("class", "overlayBox");
                var div1 = document.createElement('div');
                div1.setAttribute("class", "myMarkCircleBox");
                var div2 = document.createElement('div');
                div2.setAttribute("class", "myMarkCircle first");
                var div3 = document.createElement('div');
                div3.setAttribute("class", "myMarkCircle second");
                var div4 = document.createElement('div');
                div4.setAttribute("class", "myMarkCircle third");
                var div5 = document.createElement('div');
                div5.setAttribute("class", "myMarkCircle fourth");
                var div6 = document.createElement('div');
                div6.setAttribute("class", "myMarkCircle fifth text-center text-secondary d-grid align-content-center");
                div6.innerText = "???";
                var div7 = document.createElement('div');
                div7.setAttribute("class", "squareProp");
                var div8 = document.createElement('div');
                div8.setAttribute("class", "topSquareProp");
                var div9 = document.createElement('div');
                div9.setAttribute("class", "frontSquareProp");
                var div10 = document.createElement('div');
                div10.setAttribute("class", "sideSquareProp");
                var div11 = document.createElement('div');
                div11.setAttribute("class", "lineProp");
                var div12 = document.createElement('div');
                div12.setAttribute("class", "circleProp");

                div1.appendChild(div2);
                div1.appendChild(div3);
                div1.appendChild(div4);
                div1.appendChild(div5);
                div1.appendChild(div6);

                div7.appendChild(div8);
                div7.appendChild(div9);
                div7.appendChild(div10);

                content.appendChild(div1);
                content.appendChild(div7);
                content.appendChild(div11);
                content.appendChild(div12);

                // var content = '<div class="overlayBox">' +
                //     '<div class="myMarkCircleBox">' +
                //             '<div class="myMarkCircle first"></div>' +
                //             '<div class="myMarkCircle second"></div>' + 
                //             '<div class="myMarkCircle third"></div>' +
                //             '<div class="myMarkCircle fourth"></div>' +
                //             '<div class="myMarkCircle fifth text-center text-secondary d-grid align-content-center">???</div>' +
                //         '</div>' +
                //         '<div class="squareProp">' +
                //             '<div class="topSquareProp"></div>' +
                //             '<div class="frontSquareProp"></div>' +
                //             '<div class="sideSquareProp"></div>' +
                //         '</div>' +
                //         '<div class="lineProp"></div>' +
                //         '<div class="circleProp"></div>' +
                //     '</div>';

                var customOverlay = new kakao.maps.CustomOverlay({
                    position: position,
                    content: content
                });

                customOverlay.setMap(map);

                markedMineMarkers.push(customOverlay);

                div1.onclick = () => {
                    showMarkedModal(e);
                };

                // content.onclick = null;
                
                // content.addEventListener('click', () => {
                //     showMarkedModal(e);
                // });

            }

            function setMarkedMineMarkers(map) {
                for(var i = 0 ; i < markedMineMarkers.length ; i++) {
                    markedMineMarkers[i].setMap(map);
                }
            }

            function removeMarkedMineMarkers() {
                setMarkedMineMarkers(null);
                markedMineMarkers = [];
            }

            function scaning() {
                hideActionMenu();
                getMyLocation();
                removeMarkedMineMarkers();
                
                setTimeout(() => {

                    var content = '<div id="markScanCircle"></div>';
                    var position =  new kakao.maps.LatLng(currentLat, currentLng);

                    var customOverlay = new kakao.maps.CustomOverlay({
                        position: position,
                        content: content
                    });

                    customOverlay.setMap(map);

                    setTimeout(() => {
                        customOverlay.setMap(null);
                        showScanResult();
                    }, 3000);

                }, 700);
            }

            function tracingAnimation(lat, lng) {
                var currentPosition = new kakao.maps.LatLng(currentLat, currentLng);
                var position = new kakao.maps.LatLng(lat, lng);
                map.panTo(position);

                var content = '<div id="markScanCircle"></div>';

                var customOverlay = new kakao.maps.CustomOverlay({
                    position: position,
                    content: content
                });

                customOverlay.setMap(map);

                setTimeout(() => {
                    customOverlay.setMap(null);
                    map.panTo(currentPosition);
                    
                    const actionMenuButton = document.getElementById("actionMenuButton");
                    actionMenuButton.style.animation = 'showSomthing 0.3s linear 1';
                    actionMenuButton.style.animationFillMode = 'both';
                    actionMenuButton.hidden = false;

                    const reloadPositionButton = document.getElementById("reloadPositionButton");
                    reloadPositionButton.style.animation = 'showSomthing 0.3s linear 1';
                    reloadPositionButton.style.animationFillMode = 'both';

                    const collectionButton = document.getElementById("collectionButton");
                    collectionButton.style.animation = 'showSomthing 0.3s linear 1';
                    collectionButton.style.animationFillMode = 'both';

                    reloadPositionButton.hidden = false;
                    collectionButton.hidden = false;

                    setTimeout(() => {
                        walkingPawMarker(currentPosition, position);
                    }, 1000);

                }, 3000);

            }

            function walkingPawMarker(currentPosition, position) {

                const proj = map.getProjection();
                var center = proj.containerPointFromCoords(currentPosition);
                var pos = proj.containerPointFromCoords(position);

                var angle = getAngle(center, pos);

                var content = document.createElement('div');
                content.setAttribute("class", "walkingPawCircle");
                content.style.transform = "rotate(" + angle + "deg)";

                var div1 = document.createElement('div');
                div1.setAttribute("class", "material-symbols-outlined walkingPawIcon first");
                div1.innerText = "pets";
                var div2 = document.createElement('div');
                div2.setAttribute("class", "material-symbols-outlined walkingPawIcon second");
                div2.innerText = "pets";
                var div3 = document.createElement('div');
                div3.setAttribute("class", "material-symbols-outlined walkingPawIcon third");
                div3.innerText = "pets";
                var div4 = document.createElement('div');
                div4.setAttribute("class", "material-symbols-outlined walkingPawIcon fourth");
                div4.innerText = "pets";
                var div5 = document.createElement('div');
                div5.setAttribute("class", "material-symbols-outlined walkingPawIcon fifth");
                div5.innerText = "pets";
                var div6 = document.createElement('div');
                div6.setAttribute("class", "material-symbols-outlined walkingPawIcon sixth");
                div6.innerText = "pets";
                var div7 = document.createElement('div');
                div7.setAttribute("class", "material-symbols-outlined walkingPawIcon seventh");
                div7.innerText = "pets";

                content.appendChild(div1);
                content.appendChild(div2);
                content.appendChild(div3);
                content.appendChild(div4);
                content.appendChild(div5);
                content.appendChild(div6);
                content.appendChild(div7);

                var customOverlay = new kakao.maps.CustomOverlay({
                    position: currentPosition,
                    content: content
                });

                customOverlay.setMap(map);

                setTimeout(() => {
                    customOverlay.setMap(null);
                    getTrackingList();
                }, 3000);

            }

            function getAngle(center, target) {
                var dx = target.x - center.x;
                var dy = center.y - target.y;
                var deg = Math.atan2( dy , dx ) * 180 / Math.PI; 

                return ((-deg + 360) % 360 | 0) + 90;
            }

            function displayTracingMarker(e) {

                var center = new kakao.maps.LatLng(e.latitude, e.longitude);

                var circle = new kakao.maps.Circle({
                    center : center,
                    radius : 1000,
                    strokeWeight : 5,
                    strokeColor : "#39DE2A",
                    strokeOpacity : 1,
                    strokeStyle : "dashed",
                    fillColor : "#A2FF99",
                    fillOpacity : 0.7
                });

                circle.setMap(map);
                tracingMarkers.push(circle);

                var iwContent = '<div style="padding:3px; font-size: 0.8rem;">' + e.time_limit + '까지</div>';

                var infowindow = new kakao.maps.InfoWindow({
                    map: map,
                    position : center,
                    content : iwContent,
                    disableAutoPan : true
                });

                tracingInfoMarkers.push(infowindow);

            }

            function setTracingMarkers(map) {
                for(var i = 0 ; i < tracingMarkers.length ; i++) {
                    tracingMarkers[i].setMap(map);
                    tracingInfoMarkers[i].close();
                }
            }

            function removeTracingMarkers() {
                setTracingMarkers(null);
                tracingMarkers = [];
                tracingInfoMarkers = [];
            }

        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    </body>
    
</html>